#!/usr/bin/perl -w

use strict;
use warnings;

use DBI;

# Copyright 2007, Cluster Resources
# By Michael Moore, mmoore@clusterresources.com
#
# Submit jobs to the mtestd queue so that no two jobs will run at the same time 

die("this program must be run as root") unless(getpwuid($>) eq 'root');

die("Please provide a test!") unless($ARGV[0]);

# Let us use relative paths
my $path;
$path = `pwd`;
$path =~ s/^\s*(\S*(?:\s+\S+)*)\s*$/$1/;
$path .= '/';
unless($ARGV[0] =~ m/^\//)
{
    $ARGV[0] = $path . $ARGV[0];
}

my $dbh = DBI->connect('DBI:mysql:perltest','perltest','perltestpassword');
my @keys = ('id');

my $statement;
if($ARGV[1]){
    $ARGV[1] = $path . $ARGV[1] unless($ARGV[1] =~ m/^\//);# Let us use relative paths
    $statement = "INSERT INTO `sched` (`test`,`conf_file`) VALUES ('"  . $ARGV[0] . "','" . $ARGV[1] . "')"; 
} else {
    $statement = "INSERT INTO `sched` (`test`) VALUES ('"  . $ARGV[0] . "')"; 
}

my $sth = $dbh->prepare($statement) or logError("Couldn't prepare daily insert statement!");
my $rv = $sth->execute() or logError("Couldn't execute daily insert statement!");

